{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "_Institut Umwelt und Natürliche Ressource, FG Geoinformatik\n",
    "Modul Angewandte Geoinformatik: Herbstsemester 2019_\n",
    "\n",
    "\n",
    "# Zentralitätsmasse\n",
    "\n",
    "KW 45\n",
    "\n",
    "```{admonition} Übungsziele\n",
    "Ziele der heutigen Übung sind:\n",
    ":class: attention\n",
    "- Einfache GIS-Operationen mit QGIS durchführen können (Clip, Reproject, Abfrage der Attributtabelle, Symbolisierung, Export als jpg)\n",
    "- Schnittstelle zwischen QGIS und anderer GIS-Software am Beispiel GRASS kennenlernen\n",
    "- Erste Netzwerkoperationen mit QGIS/GRASS GIS durchführen\n",
    "- Netzwerk-Zentralitätsmasse verstehen und für einfache Netzwerkdaten berechnen\n",
    "```\n",
    "\n",
    "\n",
    "\n",
    "\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 1. Einfache GIS Operationen mit QGIS\n",
    "\n",
    "Starten Sie «QGIS 3. 10 .0 with GRASS GIS 7. 8 .1», beginnen Sie ein neues QGIS Projekt und speichern dies an\n",
    "einem geeigneten Ort (siehe Vorbereitungsübungen) ab. Weisen Sie dem Projekt das Koordinatensystem\n",
    "EPSG 2056 zu und importieren die Gemeindegrenze sowie die OSM Strassendaten aus der\n",
    "Vorbereitungsübung.\n",
    "\n",
    "### Übung 1: Daten Transformieren\n",
    "\n",
    "Die OSM Daten sind aktuell noch im Koordinatensystem WGS84 (EPSG 4326). Die Gemeindegrenze hingegen\n",
    "ist mit den neuen Schweizer Landeskoordinaten CH1903+ LV95 (EPSG 2056) abgespeichert. Wir wollen in\n",
    "unserer Analyse mit CH1903+ LV95 (EPSG 2056) arbeiten. Transformieren Sie dazu den Strassendatensatz in\n",
    "das Koordinatensystem CH1903+ LV95 (EPSG 2056). Nutzen Sie dazu das Tool «Reproject Layer».\n",
    "\n",
    "Viele wichtige Tools lassen sich über den Menü Bar aufrufen (v.a. «Vector» und «Raster»). Die Tools lassen\n",
    "sich auch relativ rasch mit der Suchfunktion der «Processing Toolbox» finden.\n",
    "\n",
    "```{figure} figures/ueb1_fig1.jpg\n",
    ":width: 400px\n",
    ":name: figure1\n",
    "\n",
    "```"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Übung 2: Daten Clippen\n",
    "\n",
    "Zoomen sie auf die Gemeindegrenze (Layers Panel -> Rechtsklick auf Datensatz -> Zoom to layer»). Es ist\n",
    "ersichtlich, dass die Strassendaten über die Gemeindegrenze hinaus verlaufen. Wir möchten für die\n",
    "kommenden Übungen nur die Strassen, die _innerhalb_ der Gemeinde Wädenswil liegen. Dazu müssen wir das\n",
    "Strassennetz mit der Gemeindegrenze verschneiden («clip»). Führen Sie das gleichnamige Werkzeug mit\n",
    "dem Input Layer «OSM_highway» und dem Clip Layer «Stadt_ Waedenswil.gpkg» aus.\n",
    "\n",
    "Es gibt eine ganze Reihe Werkzeuge zum Begriff «clip». Entscheiden Sie selbst, welches für diese\n",
    "Fragestellung geeignet ist.\n",
    "\n",
    "## 2. Arbeiten mit GRASS GIS Plugin\n",
    "\n",
    "Die mächtigsten (aber nicht die einzigen*) Netzwerkanalyse Werkzeuge in QGIS stammen aus dem\n",
    "eigenständigen GIS «GRASS GIS», welches bei der Installation von QGIS mitinstalliert wird. Diese können\n",
    "innerhalb von QGIS verwendet werden.\n",
    "\n",
    "(*) Da QGIS wie bereits erwähnt von verschiedenen Personen und Gruppen entwickelt wird, gibt es auch\n",
    "Doppelspurigkeiten, die man so in einer kommerziellen Software wie ArcGIS weniger vorfindet. In dieser\n",
    "Hinsicht ist QGIS sehr ähnlich wie die Programmiersprache R.\n",
    "\n",
    "### Übung 3: Topologie bereinigen\n",
    "\n",
    "Das OSM Strassennetz «osm_highway» ist topologisch nicht perfekt für unsere Zwecke vorbereitet. An\n",
    "Kreuzungen fehlen teilweise Knoten, welche ein «abbiegen» auf der Kreuzung ermöglich. Um diesen\n",
    "Umstand zu beheben, nutzen wir das Tool «v.clean» und führen damit die Operation «break» durch.\n",
    "Dadurch werden Linien an Kreuzungen unterbrochen. Diese Operation löst einige topologische Fehler, führt\n",
    "z.B. bei Brücken und Tunnels aber euch neue Unstimmigkeiten ein, die Sie an dieser Stelle aber getrost\n",
    "ignorieren können.\n",
    "\n",
    "1. Werkzeug “v.clean” auswählen\n",
    "2. Parameter:\n",
    "    a. _Layer to clean_ : Transformierter und geclippter OSM Strassendatensatz\n",
    "    b. _Cleaning tool_ : break\n",
    "    c. _v.out.ogr output type:_ auto\n",
    "3. Mit “Run” ausführen"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Übung 4: Losgelöste (getrennte) Elemente entfernen\n",
    "\n",
    "Aufmerksamen Anwendern könnte nun auffallen, dass gewisse Bestandteile des Netzwerks nicht mit dem\n",
    "Hauptnetz verbunden sind. Diese getrennten Elemente können mit dem Werkzeug v.net.components\n",
    "identifiziert werden. Das Werkzeug prüft, welche Bestandteile des Netzwerkes miteinander verbunden sind\n",
    "und gruppiert diese mit Nummern. Im Idealfall sollte unser Netzwerk aus einer Gruppe bestehen; so wäre\n",
    "jeder Knotenpunkt mit jedem andern Knotenpunkt verbunden: Bei uns ist dies jedoch nicht der Fall. Damit\n",
    "wir in den nachstehenden Übungen mit einem sauberen Datensatz arbeiten können, bereinigen wir dieses\n",
    "Problem an dieser Stelle:\n",
    "\n",
    "1. Führen Sie das Werkzeug aus\n",
    "    a. _Type of components_ : «strong»\n",
    "    b. _V.out.ogr output type:_ auto\n",
    "2. Symbolisieren den entstandenen Liniendatensatz nach den vergebenen Kategorien («comp»)\n",
    "3. Ermitteln Sie die Nummer der Hauptkategorie (z.B. mit dem Werkzeug «Identify Features»\n",
    "4. Öffnen Sie die Attributtabelle und machen eine «Selektion anhand einer Abfrage» («Select Features\n",
    "    using an expression» [1])\n",
    "5. Selektieren Sie die Hauptkategorie mittels einer korrekten Abfrage (z.B. comp = 99). QGIS bietet\n",
    "    ihnen hierfür leider wenig Hilfestellung (im Gegensatz zum Query Builder von ArcGIS)\n",
    "6. Um sich von den anderen Kategorien zu trennen, haben Sie nun zwei Möglichkeiten:\n",
    "    a. Eine Editiersession starten [2], die Selektion invertieren [3] und die selektierten Daten\n",
    "       löschen [4]. Speichern Sie den Layer anschliessend mit folgendem Namen ab:\n",
    "       «osm_highway_prepared.gpkg»\n",
    "       ODER\n",
    "    b. Selektierte Daten (ohne Invertierung) in ein neues File exportieren mittels Rechtsklick auf\n",
    "       den Layer -> «Save as» -> Häkchen bei «Save only selected features» -> Speichern als\n",
    "       «osm_highway_prepared.gpkg».\n",
    "       \n",
    "```{figure} figures/ueb1_fig2.jpg\n",
    ":width: 400px\n",
    ":name: figure2\n",
    "\n",
    "```\n",
    "       "
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
